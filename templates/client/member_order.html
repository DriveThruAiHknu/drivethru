{% extends 'client/client_base.html' %}

{% block content %}

{% load static %}
<script src="http://code.jquery.com/jquery-latest.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'client/style/member_order_style.css' %}">

<div id="content_all">

    <!-- ai -->
    <div class="h-25" id="bot">
        <div class="row" id="ai">
            <div class="ai_img"></div>
            <div class="ai_txt">
                <h2 id="ai_say">ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿</h2>
            </div>

        </div>

    </div>

    <div class="h-50" id="top">

        <div class="row">

            <div class="col-md-6" id="box1">
                <h4 id="menu_txt"> ìµœê·¼ ì£¼ë¬¸ ë©”ë‰´</h4>
           

            
            <div class="row">
                <!-- ìƒí’ˆ 1, 2-->

                <!-- ìƒí’ˆ1 -->
                <div class="col-md-6" id="item1">
                    <div class="bg_image1">
                        <div class="image1"></div>
                        <div class="image_num_0"><h4>1</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_1_id">[ICE] ì•„ë©”ë¦¬ì¹´ë…¸</h5>
                        <h5 class="new" id="new_1_price">4.3</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ2 -->
                <div class="col-md-6" id="item2">
                    <div class="bg_image2">
                        <div class="image2"></div>
                        <div class="image_num_0"><h4>2</h4></div>
                    </div>
                    <div id="txt_box">
                    <h5 class="new" id="new_2_id">[HOT] ì¹´í‘¸ì¹˜ë…¸</h5>
                    <h5 class="new" id="new_2_price">5.4</h5>
                    </div>
                </div>

            </div>
        </div>
            
            <div class="col-md-6" id="box1">
                <h4 id="menu_txt"> ìµœë‹¤ ì£¼ë¬¸ ë©”ë‰´</h4>

            
            <div class="row">
                <!-- ìƒí’ˆ 3, 4-->

                <!-- ìƒí’ˆ3 -->
                <div class="col-md-6" id="item3">
                    <div class="bg_image3">
                        <div class="image3"></div>
                        <div class="image_num"><h4>3</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_3_id">[ICE] ì¹´í˜ë¼ë–¼</h5>
                        <h5 class="new" id="new_3_price">4.4</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ4 -->
                <div class="col-md-6" id="item4">
                    <div class="bg_image4">
                        <div class="image4"></div>
                        <div class="image_num"><h4>4</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_4_id">[HOT] ì½”ì½”ì•„</h5>
                        <h5 class="new" id="new_4_price">3.5</h5>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- ìƒí’ˆ 5, 6-->

                <!-- ìƒí’ˆ5 -->
                <div class="col-md-6" id="item5">
                    <div class="bg_image5">
                        <div class="image5"></div>
                        <div class="image_num_2"><h4>5</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_5_id">[BAKERY] ê³¡ë¬¼ ë¹µ</h5>
                        <h5 class="new" id="new_5_price">4.1</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ6 -->
                <div class="col-md-6" id="item6">
                    <div class="bg_image6">
                        <div class="image6"></div>
                        <div class="image_num_2"><h4>6</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_6_id">[ICE] ë³µìˆ­ì•„ í‹°</h5>
                        <h5 class="new" id="new_6_price">4.8</h5>
                    </div>
                </div>

            </div>
            
        </div>

        </div>

    </div>


    <!--ì£¼ë¬¸ ëª©ë¡-->
    <div class="h-25" id="mid">

        <!-- ì œëª©-->
        <div class="row" id="title">
            <div class="col-md-3"> 
                <h3>ì£¼ë¬¸í•˜ì‹  ë©”ë‰´</h3>
            </div>
            <div class="col-md-4"> 
                <h3>ì˜µì…˜</h3>
            </div>
            <div class="col-md-2"> 
                <h3>ê°€ê²©</h3>
            </div>
            <div class="col-md-1"> 
                <h3>ìˆ˜ëŸ‰</h3>
            </div>
            <div class="col-md-2"> 
                <h3>ì´í•©</h3>
            </div>
        </div>

        <!-- ì‹¤ì œ í•­ëª©-->
        <!-- ì£¼ë¬¸ëª©ë¡-->
        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì•„ë©”ë¦¬ì¹´ë…¸</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸ice âœ”ï¸ì‹œëŸ½ ë°”ë‹ë¼ 2 âœ”ï¸ìƒ· 3<br>âœ”ï¸ìš°ìœ  ì €ì§€ë°© âœ”ï¸íœ˜í•‘ O âœ”ï¸ë“œë¦¬ì¦ ì´ˆì½”</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,300 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">1</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,300 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì¹´í‘¸ì¹˜ë…¸</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸ice âœ”ï¸ì‹œëŸ½ X âœ”ï¸ìƒ· 5<br>âœ”ï¸ìš°ìœ  X âœ”ï¸íœ˜í•‘ O âœ”ï¸ë“œë¦¬ì¦ X</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">5,400 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">3</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">16,200 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì¹´í˜ë¼ë–¼</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸hot âœ”ï¸ì‹œëŸ½ ì¹´ë¼ë©œ 1 âœ”ï¸ìƒ· 2<br>âœ”ï¸ìš°ìœ  ê¸°ë³¸ âœ”ï¸íœ˜í•‘ X âœ”ï¸ë“œë¦¬ì¦ ì´ˆì½”</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,400 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">2</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">8,800 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6" id="border3"> 
                <h3 id="total_txt">ì£¼ë¬¸ ê¸ˆì•¡</h3>
            </div>
            <div class="col-md-6" id="border2">
                <h3 id="total_real">8,800 ì›</h3>
            </div>
        </div>
    </div>



    </div>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>


    /* ë©”ì¸ */
    var txt = document.getElementById("ai_say");
    var say_return = "";
    //$("#ai_say").text("ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿");
    txt.innerHTML = "ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿";

    window.onload=function()
    {

        //setVoiceList();
        //speech("ì•ˆë…•");
        
        /*var u = new SpeechSynthesisUtterance();
        u.text = "ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤. ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤";
        speechSynthesis.speak(u);*/

        setTimeout(() => 
        { 
            //console.log(window.speechSynthesis.getVoices());
            order();
        }, 1000);
    }


    /* ì‹¤ì œ ë¹„ë™ê¸° ì²˜ë¦¬ ì½”ë“œ */
    async function order()
    {
        var audio_once = false; //í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í–ˆëŠ”ì§€

        try
        {
            var audio1 = await tts("ì–´ì„œì˜¤ì„¸ìš”. ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤!");

            txt.innerHTML = "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”ğŸ’š";
            var audio2 = await tts("ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”!");

            txt.innerHTML = "ì¸ì‹ ì¤‘ ...!"; //ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ë“¤ì–´ê°€ë©´ ì¢‹ì„ ê±° ê°™ìŒ

            // 83ì´ˆ ëŒ€ê¸°
            //await new Promise((resolve, reject) => setTimeout(resolve, 8300));

            var audio_once = true;

            while(true)
            {
                if(audio_once) // ì£¼ë¬¸í•œì  X
                {
                    console.log("ì£¼ë¬¸í•œ ì  X");
                    var stt1 = await speech_to_text();

                    if (stt1.length > 1) //í•œ ê¸€ì ì´ìƒ ë“¤ì–´ì˜¤ë©´
                    {
                        txt.innerHTML = "âœ…"+stt1;
                        var audio3 = await tts(stt1+"\në©”ë‰´ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤!");

                        txt.innerHTML = 'ê²°ì œ ë˜ëŠ” ì¶”ê°€í•  ë©”ë‰´ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”â—';
                        var audio4 = await tts("ê²°ì œ ë˜ëŠ” ì¶”ê°€í•  ë©”ë‰´ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”!");

                        audio_once = false;
                    }
                    else //í•œ ê¸€ìë„ ì•ˆ ë“¤ì–´ì˜¤ë©´
                    {
                        txt.innerHTML = "âœ”ï¸ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë§ì”€í•´ì£¼ì„¸ìš”!";
                        var audio5 = await tts("ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë§ì”€í•´ì£¼ì„¸ìš”!");
                    }
                }
                
                else // 1ë©”ë‰´ ì´ìƒ ì£¼ë¬¸ O
                {
                    console.log("í•œë²ˆ ì´ìƒ ì£¼ë¬¸");
                    txt.innerHTML = 'ğŸ“Œ "ê²°ì œ"ë¼ê³  ë§ì”€í•˜ì‹œë©´ ì£¼ë¬¸ì´ ì¢…ë£Œë©ë‹ˆë‹¤.';

                    var stt2 = await speech_to_text();

                    if (stt2.length > 1) //í•œ ê¸€ì ì´ìƒ ë“¤ì–´ì˜¤ë©´
                    {
                        if (stt2 == "ê²°ì œ" | stt2 == "ê²°ì¬" | stt2 == "ì²«ì§¸") //ê²°ì œ ì›í•˜ë©´
                        {
                            console.log("ì£¼ë¬¸ ì¢…ë£Œ");
                            txt.innerHTML="âœ”ï¸ ê²°ì œ ì•ˆë‚´ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤";
                            var audio5 = await tts("ê²°ì œ ì•ˆë‚´ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤!");
                            await new Promise((resolve, reject) => setTimeout(resolve, 1300));
                            break;
                        }
                        else //ê³„ì† ë©”ë‰´ ë°›ê³  ì‹¶ìœ¼ë©´
                        {
                            txt.innerHTML = "âœ…"+stt2;
                            var audio3 = await tts(stt2+" ë©”ë‰´ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");

                            txt.innerHTML = '"ê²°ì œ" / "ì¶”ê°€í•  ë©”ë‰´"ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”â—';
                            var audio4 = await tts("ê²°ì œ ë˜ëŠ” ì¶”ê°€í•  ë©”ë‰´ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”~");
                        }
                    }
                    else //í•œ ê¸€ìë„ ì•ˆ ë“¤ì–´ì˜¤ë©´
                    {
                        txt.innerHTML="âœ”ï¸ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë§ì”€í•´ì£¼ì„¸ìš”!";
                        var audio5 = await tts("ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë§ì”€í•´ì£¼ì„¸ìš”!");
                    }




                }
            }
            
            location.href="/client/end";
        }
        catch(error)
        {
            console.log(error);
        }
            
    }

    /* STT */
    var isRecognizing = false;

    try 
    { 
        var recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
    } 
    catch(e)
    {
        console.error(e);
    }

    recognition.lang = 'ko-KR';
    recognition.interimResults = false;
    recognition.maxAlternatives = 100; //í´ìˆ˜ë¡ ë°œìŒëŒ€ë¡œ ì•ˆì ê³  ë¬¸ì¥ ì í•©ë„ë¡œ.
    recognition.continuous = false; //ìŒì„±ì¸ì‹ ì•ˆëë‚˜ê³  ê³„ì†ë¨

    async function speech_to_text()
    {
        var resText = "";
        var txt = document.getElementById("ai_say");
        recognition.start();
        isRecognizing = true;

        recognition.onstart = function()
        {
            console.log("------------------------ìŒì„±ì¸ì‹ ì‹œì‘------------------------");
        }   

        recognition.onresult = function(event) 
        {
            resText = event.results[0][0].transcript;
            //console.log('You said: ', resText);
            txt.innerHTML = resText;

            if (resText == "ê²°ì œ" | resText == "ê²°ì œ.")
            {
                console.log("ê²°ì œë¼ê³  ë§í•¨");
                return "ê²°ì œ";
            }

            console.log('STT ë°˜í™˜:', resText);

        };

        await new Promise(resolve =>
            recognition.onend = e => {
            {
                console.log("------------------------ìŒì„±ì¸ì‹ ì¢…ë£Œ------------------------");
                resolve();
            }})
        
        recognition.stop();

        resText = resText.replace(".","");
        return resText;
    }


    /* TTS */
    var voices = [];


    function setVoiceList() {
        voices = window.speechSynthesis.getVoices();
    }
    if (window.speechSynthesis.onvoiceschanged !== undefined) 
    {
        window.speechSynthesis.onvoiceschanged = setVoiceList;
    }


    async function tts(txt) 
    {
        var end = false;

        if(!window.speechSynthesis) 
        {
            alert("ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. í¬ë¡¬, íŒŒì´ì–´í­ìŠ¤ ë“±ì˜ ìµœì‹  ë¸Œë¼ìš°ì €ë¥¼ ì´ìš©í•˜ì„¸ìš”");
            return;
        }

        var lang = 'ko-KR';
        var utterThis = new SpeechSynthesisUtterance(txt);

        utterThis.text = txt;
        utterThis.lang = lang;
        utterThis.pitch = 1;
        utterThis.rate = 1; //ì†ë„

        //ê¸°ì¡´
        utterThis.onerror = function(event) 
        {
            console.log('error', event);
        };

        var voiceFound = false;

        for(var i = 0; i < voices.length ; i++) 
        {
            if(voices[i].lang.indexOf(lang) >= 0 || voices[i].lang.indexOf(lang.replace('-', '_')) >= 0) 
            {
                utterThis.voice = voices[i];
                voiceFound = true;
            }
        }
        if(!voiceFound) 
        {
            alert('voice not found');
            return;
        }
        
        /*utterThis.onend = function (event) 
        {
            //console.log('ë§ ëë‚¨');
            //console.log(print_txt," ì¶œë ¥í•  ì°¨ë¡€ ");
            var txt = document.getElementById("ai_say");
            txt.innerHTML = print_txt;
        };
        window.speechSynthesis.speak(utterThis);
        */

        await new Promise(function(resolve) 
        {
            utterThis.onend = resolve;
            window.speechSynthesis.speak(utterThis);
        });
    }

</script>
{% endblock %}