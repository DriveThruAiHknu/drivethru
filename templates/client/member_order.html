{% extends 'client/client_base.html' %}

{% block content %}

{% load static %}
<script src="http://code.jquery.com/jquery-latest.js"></script>
<link rel="stylesheet" type="text/css" href="{% static 'client/style/member_order_style.css' %}">

<div id="content_all">

    <!-- ai -->
    <div class="h-25" id="bot">
        <div class="row" id="ai">
            <div class="ai_img"></div>
            <div class="ai_txt">
                <h2 id="ai_say">ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿</h2>
            </div>

        </div>

    </div>

    <div class="h-50" id="top">

        <div class="row">

            <div class="col-md-6" id="box1">
                <h4 id="menu_txt"> ìµœê·¼ ì£¼ë¬¸ ë©”ë‰´</h4>
           

            
            <div class="row">
                <!-- ìƒí’ˆ 1, 2-->

                <!-- ìƒí’ˆ1 -->
                <div class="col-md-6" id="item1">
                    <div class="bg_image1">
                        <div class="image1"></div>
                        <div class="image_num_0"><h4>1</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_1_id">[ICE] ì•„ë©”ë¦¬ì¹´ë…¸</h5>
                        <h5 class="new" id="new_1_price">4.3</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ2 -->
                <div class="col-md-6" id="item2">
                    <div class="bg_image2">
                        <div class="image2"></div>
                        <div class="image_num_0"><h4>2</h4></div>
                    </div>
                    <div id="txt_box">
                    <h5 class="new" id="new_2_id">[HOT] ì¹´í‘¸ì¹˜ë…¸</h5>
                    <h5 class="new" id="new_2_price">5.4</h5>
                    </div>
                </div>

            </div>
        </div>
            
            <div class="col-md-6" id="box1">
                <h4 id="menu_txt"> ìµœë‹¤ ì£¼ë¬¸ ë©”ë‰´</h4>

            
            <div class="row">
                <!-- ìƒí’ˆ 3, 4-->

                <!-- ìƒí’ˆ3 -->
                <div class="col-md-6" id="item3">
                    <div class="bg_image3">
                        <div class="image3"></div>
                        <div class="image_num"><h4>3</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_3_id">[ICE] ì¹´í˜ë¼ë–¼</h5>
                        <h5 class="new" id="new_3_price">4.4</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ4 -->
                <div class="col-md-6" id="item4">
                    <div class="bg_image4">
                        <div class="image4"></div>
                        <div class="image_num"><h4>4</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_4_id">[HOT] ì½”ì½”ì•„</h5>
                        <h5 class="new" id="new_4_price">3.5</h5>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- ìƒí’ˆ 5, 6-->

                <!-- ìƒí’ˆ5 -->
                <div class="col-md-6" id="item5">
                    <div class="bg_image5">
                        <div class="image5"></div>
                        <div class="image_num_2"><h4>5</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_5_id">[BAKERY] ê³¡ë¬¼ ë¹µ</h5>
                        <h5 class="new" id="new_5_price">4.1</h5>
                    </div>
                </div>

                <!-- ìƒí’ˆ6 -->
                <div class="col-md-6" id="item6">
                    <div class="bg_image6">
                        <div class="image6"></div>
                        <div class="image_num_2"><h4>6</h4></div>
                    </div>
                    <div id="txt_box">
                        <h5 class="new" id="new_6_id">[ICE] ë³µìˆ­ì•„ í‹°</h5>
                        <h5 class="new" id="new_6_price">4.8</h5>
                    </div>
                </div>

            </div>
            
        </div>

        </div>

    </div>


    <!--ì£¼ë¬¸ ëª©ë¡-->
    <div class="h-25" id="mid">

        <!-- ì œëª©-->
        <div class="row" id="title">
            <div class="col-md-3"> 
                <h3>ì£¼ë¬¸í•˜ì‹  ë©”ë‰´</h3>
            </div>
            <div class="col-md-4"> 
                <h3>ì˜µì…˜</h3>
            </div>
            <div class="col-md-2"> 
                <h3>ê°€ê²©</h3>
            </div>
            <div class="col-md-1"> 
                <h3>ìˆ˜ëŸ‰</h3>
            </div>
            <div class="col-md-2"> 
                <h3>ì´í•©</h3>
            </div>
        </div>

        <!-- ì‹¤ì œ í•­ëª©-->
        <!-- ì£¼ë¬¸ëª©ë¡-->
        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì•„ë©”ë¦¬ì¹´ë…¸</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸ice âœ”ï¸ì‹œëŸ½ ë°”ë‹ë¼ 2 âœ”ï¸ìƒ· 3<br>âœ”ï¸ìš°ìœ  ì €ì§€ë°© âœ”ï¸íœ˜í•‘ O âœ”ï¸ë“œë¦¬ì¦ ì´ˆì½”</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,300 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">1</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,300 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì¹´í‘¸ì¹˜ë…¸</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸ice âœ”ï¸ì‹œëŸ½ X âœ”ï¸ìƒ· 5<br>âœ”ï¸ìš°ìœ  X âœ”ï¸íœ˜í•‘ O âœ”ï¸ë“œë¦¬ì¦ X</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">5,400 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">3</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">16,200 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3" id="border"> 
                <h4 id="list_txt">ì¹´í˜ë¼ë–¼</h4>
            </div>
            <div class="col-md-4" id="border"> 
                <h5 id="op_txt">âœ”ï¸hot âœ”ï¸ì‹œëŸ½ ì¹´ë¼ë©œ 1 âœ”ï¸ìƒ· 2<br>âœ”ï¸ìš°ìœ  ê¸°ë³¸ âœ”ï¸íœ˜í•‘ X âœ”ï¸ë“œë¦¬ì¦ ì´ˆì½”</h5>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">4,400 ì›</h4>
            </div>
            <div class="col-md-1" id="border"> 
                <h4 id="list_txt">2</h4>
            </div>
            <div class="col-md-2" id="border"> 
                <h4 id="list_txt">8,800 ì›</h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6" id="border3"> 
                <h3 id="total_txt">ì£¼ë¬¸ ê¸ˆì•¡</h3>
            </div>
            <div class="col-md-6" id="border2">
                <h3 id="total_real">8,800 ì›</h3>
            </div>
        </div>
    </div>



    </div>

</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script>
    var txt = document.getElementById("ai_say");
    txt.innerHTML = "ğŸŒ¿ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿";

    /* fetchë¡œ ì €ì¥ëœ ì˜¤ë””ì˜¤ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ */
    function PlayAudio(num) {
        var url = "http://localhost:8000/client/play?file_name=" + num
        return fetch(url).then(function(response) {
            return response.blob();
        });
    }

    /* fetchë¡œ ë§ˆì´í¬ ë…¹ìŒ (ì²˜ìŒì—ë§Œ -> ëª‡ì´ˆ ì´ìƒ ì§€ë‚˜ë„ ê³„ì† ê¸°ë‹¤ë ¤ì¤Œ) */
    function Voice1() {
        var url = "http://localhost:8000/client/voice1"
        return fetch(url).then(function(response) {
            return response.text();
        });
    }

    /* fetchë¡œ ë§ˆì´í¬ ë…¹ìŒ (ì´í›„ì— -> í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í–ˆìœ¼ë©´ 50ì´ˆ ì´ìƒì´ë©´ ì£¼ë¬¸ ë) */
    function Voice2() {
        var url = "http://localhost:8000/client/voice2"
        return fetch(url).then(function(response) {
            return response.text();
        });
    }

    // KAKAO STT ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ 
    function STT(file_name) {
        var url = "http://localhost:8000/client/stt?file_name=" + file_name
        return fetch(url,{
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(this.obj)
        }).then(response => response.json())
        .then(res => {//console.log("ê°ì²´",res);
        //console.log("ë¬¸ìì—´ë¡œ",JSON.stringify(res));
        var str = JSON.stringify(res).slice(8, JSON.stringify(res).length-2);
        txt.innerHTML = str; 
        return str;})
    }

    // KAKAO TTS ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    function TTS(text) {
        var url = "http://localhost:8000/client/tts?text=" + text
        return fetch(url).then(function(response) {
            return response.blob();
        });
    }

    /* async-awaitìœ¼ë¡œ ë¹„ë™ê¸°í•¨ìˆ˜ë¥¼ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ */
    async function order()
    {
        var audio_once = false; //í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í–ˆëŠ”ì§€

        try
        {
            var audio1 = await PlayAudio(1);
            if (audio1 != null ) 
            {
                txt.innerHTML = "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”ğŸ’š";
                var audio2 = await PlayAudio(2);
                if (audio2 != null)
                {
                    while(true)
                    {                        
                        if (audio_once == false) //í•œ ë²ˆë„ ì£¼ë¬¸ ì•ˆí–ˆìœ¼ë©´
                        {
                            txt.innerHTML = "(ì¸ì‹ ì¤‘ì…ë‹ˆë‹¤)"; //ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ë“¤ì–´ê°€ë©´ ì¢‹ì„ ê±° ê°™ìŒ
                            console.log("í•œë²ˆë„ ì£¼ë¬¸ ì•ˆí•¨");
                            var voice = await Voice1(); //ê³„ì† ê¸°ë‹¤ë ¤ì£¼ë©´ì„œ ë…¹ìŒ
                            audio_once = true
                        }
                        else //í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í–ˆìœ¼ë©´
                        {
                            txt.innerHTML = '(ì£¼ë¬¸ì„ ëë‚´ì‹œê³  ì‹¶ìœ¼ì‹œë©´ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)'; //ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ë“¤ì–´ê°€ë©´ ì¢‹ì„ ê±° ê°™ìŒ
                            console.log("í•œë²ˆì´ë¼ë„ ì£¼ë¬¸ í•¨.");
                            var voice = await Voice2(); //ì¼ì • ì‹œê°„ ì§€ë‚˜ë©´ ê·¸ëƒ¥ ëëƒ„.
                        }

                        if (voice == "ì €ì¥")
                        {
                            console.log("ë…¹ìŒ ì‹¤í–‰í•¨");
                            var say = await STT("ì£¼ë¬¸");

                            if (say != null)
                            {
                                console.log(say);

                                if (say != "ê²°ì œ")
                                {
                                    //sayë¥¼ ì–´ë”” ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•´ì„œ ë”°ë¡œ ì €ì¥í•´ë‘ê¸°

                                    say_ = say.replace(/ /g,","); //ê³µë°± ì‚¬ì´ì— ì‰¼í‘œ ì¶”ê°€ (ë§ ì´ìƒí•˜ê²Œ ë“¤ë ¤ì„œ)
                                    var tts = await TTS(say_);
                                    if ( tts != null)
                                    {
                                        txt.innerHTML = "ë©”ë‰´ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤."
                                        var audio5 = await PlayAudio(5);
                                        if (audio5 != null)
                                        {
                                            txt.innerHTML = "ê²°ì œ ë˜ëŠ” ì¶”ê°€í•  ë©”ë‰´ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”~"
                                            var audio6 = await PlayAudio(6);
                                            {
                                                if (audio6 != null)
                                                {
                                                    console.log("ë‹¤ì‹œ ì‹œì‘ã… ã… ");
                                                }
                                            }
                                        }
                                    }
                                }
                                
                                else if (say == "ê²°ì œ")
                                {
                                    txt.innerHTML = "âœ”ï¸ ê²°ì œ ì•ˆë‚´ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤";
                                    var audio7 = await PlayAudio(7);
                                    {
                                        if (audio7 != null)
                                        {
                                            console.log("ë!");
                                            break;
                                        }
                                    }
                                }

                            }
                        }
                        else if ( voice == "ëŒ€ê¸°ì´ˆê³¼")
                        {
                            txt.innerHTML = "âœ”ï¸ ê²°ì œ ì•ˆë‚´ë¥¼ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤";
                                    var audio7 = await PlayAudio(7);
                                    {
                                        if (audio7 != null)
                                        {
                                            console.log("ë!");
                                            break;
                                        }
                                    }
                        }
                    }
                }
            }
        }
        catch (error)
        {
            console.log(error);
        }
        
    }


    /* ë©”ì¸ */
    window.onload=function(){
        order();
    }
    
    





    /*
    <AJAX> ë¹„ë™ê¸°ë¼ì„œ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” ë¬¸ì œ

    var txt = document.getElementById("ai_say");
    txt_change = "ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿";
    txt.innerHTML = txt_change;

    function js_play(num, inner)
    {
        //ajax í†µì‹ 
        $.ajax({
        type: "GET",
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        url: "http://localhost:8000/client/play?file_name="+num
        }).done(function(o){
            txt.innerHTML = inner
        });
    }
    
    function js_tts()
    {
        //ajax í†µì‹ 
        $.ajax({
        type: "GET",
        contentType: "application/x-www-form-urlencoded; charset=UTF-8",
        url: "http://localhost:8000/client/tts?text= ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤~ "
        }).done(function(o){
            txt.innerHTML = "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼\në§ì”€í•´ì£¼ì„¸ìš”ğŸ’š\n"
        });
    }

    window.onload=function(){

        txt.innerHTML = "ğŸŒ¿ì–´ì„œì˜¤ì„¸ìš”! ìŠ¤íƒ€ë²…ìŠ¤ì…ë‹ˆë‹¤ğŸŒ¿";
        js_play(1, "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼\në§ì”€í•´ì£¼ì„¸ìš”ğŸ’š\n")
        //js_play(2, "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼\në§ì”€í•´ì£¼ì„¸ìš”ğŸ’š\n")
        
    }*/

    /* 
    <axios - Promise ê¸°ë°˜> ì½”ë“œ ê°€ë…ì„± ë–¨ì–´ì§. then ì§€ì˜¥

    axios.defaults.withCredentials = true;

    axios
    .get("http://localhost:8000/client/play?file_name=1")
    // ì‘ë‹µ(ì„±ê³µ)
    .then(function(response) {
        txt.innerHTML = "ì£¼ë¬¸ì„ ì›í•˜ì‹œëŠ” ë©”ë‰´ë‚˜ ë²ˆí˜¸ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”ğŸ’š";
        PlayAudio(2)
    })
    // ì‘ë‹µ(ì‹¤íŒ¨)
    .catch(function(error) {
    console.log(error)
    })
    // ì‘ë‹µ(í•­ìƒ ì‹¤í–‰)
    .then(function() {
    // ...
    })
    */

</script>
{% endblock %}